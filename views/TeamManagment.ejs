<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="/Teammanagment.css">
    <title>Document</title>
</head>
<body>
    <div class="TeamManagmentContainer">
        <div class = "EditableTeam">
            <div class = 'stricker cardrow'>
                <img class="pictures" src="/pictures/Card.png">
                <img class="pictures" src="/pictures/Card.png">
                <img class="pictures" src="/pictures/Card.png">
              </div>
          
              <div class = 'midfield cardrow'>
                <img class="pictures" src="/pictures/Card.png">
                <img class="pictures" src="/pictures/Card.png">
                <img class="pictures" src="/pictures/Card.png">
              </div>
          
              <div class = 'defence cardrow'>
                <img class="pictures" src="/pictures/Card.png">
                <img class="pictures" src="/pictures/Card.png">
                <img class="pictures" src="/pictures/Card.png">
                <img class="pictures" src="/pictures/Card.png">
              </div>
          
              <div class = 'goalkeeper cardrow'>
                <img class="pictures" src="/pictures/Card.png">
              </div>
          </div>
          <div class = 'bench'>
            <% FifaUser.cards.forEach((Card, Index) => { %>
              <%-include('_cards.ejs', {height: '100px', width: '70px', Card: Card, CardArray: FifaUser.cards})%>
            <% }) %>
          </div>
          <div class = 'SaveandReturn'>
            <a href="/<%=id%>">Return</a>
            <a href="/<%=id%>" onclick="SaveTeaminDatabase()">Save</a>
          </div>
     </div>
    </div>
</body>
<script>
  const bench = document.querySelector('.bench')
  const PulledPlayers = bench.querySelectorAll('div.CardContainer')
  const EmptyCards = document.querySelectorAll('.pictures')
  let ChangedCard

  PulledPlayers.forEach((PulledPlayer) => {
      PulledPlayer.addEventListener('click',() => {
        ChangedCard = PulledPlayer
      })
  })

  EmptyCards.forEach((items) => {
    items.addEventListener('click', () => {
      if (ChangedCard == undefined) return
      items.replaceWith(ChangedCard)
    })
  })

  function SaveTeaminDatabase(){
      const cardrow = document.querySelectorAll('.cardrow')
      const Goalkeeper = {PlayerName: cardrow.item(3).children.item(0).querySelector('.PlayerName').textContent}
      const LeftBack = {PlayerName: cardrow.item(2).children.item(0).querySelector('.PlayerName').textContent}
      const CenterBack1 = {PlayerName: cardrow.item(2).children.item(1).querySelector('.PlayerName').textContent}
      const CenterBack2 = {PlayerName: cardrow.item(2).children.item(2).querySelector('.PlayerName').textContent}
      const RightBack = {PlayerName: cardrow.item(2).children.item(0).querySelector('.PlayerName').textContent}
      const center1 = {PlayerName: cardrow.item(1).children.item(0).querySelector('.PlayerName').textContent}
      const center2 = {PlayerName: cardrow.item(1).children.item(1).querySelector('.PlayerName').textContent}
      const center3 = {PlayerName: cardrow.item(1).children.item(2).querySelector('.PlayerName').textContent}
      const LeftWinger = {PlayerName: cardrow.item(0).children.item(0).querySelector('.PlayerName').textContent}
      const Striker = {PlayerName: cardrow.item(0).children.item(1).querySelector('.PlayerName').textContent}
      const RightWinger = {PlayerName: cardrow.item(0).children.item(2).querySelector('.PlayerName').textContent}
      
      axios.post('/<%= locals.id %>/savedteam', {
          Goalkeeper: Goalkeeper,
          Defender: [LeftBack, CenterBack1, CenterBack2, RightBack],
          Center: [center1, center2, center3],
          Forward: [LeftWinger, Striker, RightWinger]
      })
    }
</script>
</html>